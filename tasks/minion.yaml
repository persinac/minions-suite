version: '3'

vars:
  # Secrets runner â€” override via env var to swap providers.
  # Default: doppler run --
  # AWS SM:  SECRETS_CMD="./scripts/aws-sm-run minion/prod --" task minion:server
  # None:    SECRETS_CMD="" task minion:server  (env vars already in shell)
  SECRETS_CMD:
    sh: echo "${SECRETS_CMD:-doppler run --}"

tasks:
  preflight:
    desc: Check all required tools and auth
    cmds:
      - uv run python -m minions --preflight

  review:
    desc: One-shot review of a merge/pull request
    cmds:
      - "{{.SECRETS_CMD}} uv run python -m minions review {{.CLI_ARGS}}"

  server:
    desc: Start MCP server + review engine
    deps: [preflight]
    cmds:
      - "{{.SECRETS_CMD}} uv run python -m minions --server"

  status:
    desc: Show recent review history
    cmds:
      - "{{.SECRETS_CMD}} uv run python -m minions --status"

  costs:
    desc: Show cost summary
    cmds:
      - "{{.SECRETS_CMD}} uv run python -m minions --costs {{.CLI_ARGS}}"

  logs:
    desc: Tail active agent logs
    cmds:
      - tail -f logs/agents/*.log
